<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | RehabCare+</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <h4>RehabCare+</h4>
        <a href="/dashboard" class="active">ğŸ  Dashboard</a>
        <a href="/add_patient">â• Add Patient</a>
        <a href="/patients">ğŸ§ Patients List</a> 
        <a href="/rooms">ğŸ› Rooms</a>
        <a href="/billing">ğŸ’³ Billing</a>
        <a href="/medicine_history">ğŸ’Š Medicine History</a>
        <a href="/logout">ğŸšª Logout</a>
    </div>

    <div class="content">
        <div class="navbar-custom">
            <span class="nav-title">Dashboard Overview</span>
            <button class="btn-outline btn-custom" onclick="toggleSidebar()">â˜°</button>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="flash-message flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <h2 class="page-title">Key Statistics</h2>

        <div class="row" style="display:flex; gap:20px; flex-wrap:wrap;">
            <div class="card-custom" style="flex:1; border-left: 5px solid #3B82F6; min-width: 200px;">
                <h4>Active Patients</h4>
                <h1 id="count1">{{ stats.total_patients }}</h1>
            </div>

            <div class="card-custom" style="flex:1; border-left: 5px solid #10B981; min-width: 200px;">
                <h4>Total Staff</h4>
                <h1 id="count2">{{ stats.total_staff }}</h1>
            </div>

            <div class="card-custom" style="flex:1; border-left: 5px solid #FBBF24; min-width: 200px;">
                <h4>Available Beds</h4>
                <h1 id="count3">{{ stats.available_beds }}</h1>
            </div>

            <div class="card-custom" style="flex:1; border-left: 5px solid #EF4444; min-width: 200px;">
                <h4>Pending Bills</h4>
                <h1 id="count4">{{ stats.pending_bills }}</h1>
            </div>
        </div>

        <div class="card-custom" style="margin-top:30px; padding: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">Recent Patients</h3>
                <a href="/patients" style="color: var(--primary-blue); text-decoration: none;">View All â†’</a>
            </div>

            <input type="text" id="search" class="form-control" placeholder="ğŸ” Search patient by name or code...">

            <div class="table-scroll">
                <table class="table-custom" style="margin-top:15px;">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Patient Code</th>
                            <th>Full Name</th>
                            <th>Branch</th>
                            <th>Admission Date</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>

                    <tbody id="patientTable">
                        {% if patients %}
                            {% for p in patients %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ p.patient_code }}</td>
                                <td><a href="/view_patient/{{ p.patient_id }}" style="color: var(--primary-blue);">{{ p.full_name }}</a></td> 
                                <td>{{ p.branch_name }}</td>
                                <td>{{ p.admission_date }}</td>
                                <td><span class="status-{{ p.status | lower }}">{{ p.status }}</span></td>
                                <td>
                                    <a href="/view_patient/{{ p.patient_id }}" class="action-btn view-btn" style="text-decoration: none;">View</a>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="7" style="text-align: center; color: var(--text-muted); padding: 30px;">
                                    No patients found. <a href="/add_patient" style="color: var(--primary-blue);">Add your first patient â†’</a>
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Sidebar Toggle
        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("active");
        }

        // Search Filter
        let searchBox = document.getElementById("search");
        if (searchBox) {
            searchBox.addEventListener("keyup", function () {
                let value = searchBox.value.toLowerCase();
                let rows = document.querySelectorAll("#patientTable tr");
                
                rows.forEach(row => {
                    let text = row.textContent.toLowerCase();
                    row.style.display = text.includes(value) ? "" : "none";
                });
            });
        }

        // Counter Animation
        function animateCounter(id, target) {
            let element = document.getElementById(id);
            if (!element) return;
            
            let count = 0;
            let speed = Math.max(1, target / 80);
            
            let interval = setInterval(() => {
                count += speed;
                if (count >= target) {
                    element.innerText = target;
                    clearInterval(interval);
                } else {
                    element.innerText = Math.floor(count);
                }
            }, 20);
        }

        // Animate all counters
        animateCounter("count1", {{ stats.total_patients }});
        animateCounter("count2", {{ stats.total_staff }});
        animateCounter("count3", {{ stats.available_beds }});
        animateCounter("count4", {{ stats.pending_bills }});
    </script>
</body>
</html>