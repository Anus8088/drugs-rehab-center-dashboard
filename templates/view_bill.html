<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice {{ bill.INVOICE_NUMBER }} | RehabCare+</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        .invoice-id {
            color: var(--primary-blue);
            font-size: 1.8em;
            font-weight: 700;
        }
        .invoice-summary-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        .invoice-summary-box h5 {
            margin-bottom: 5px;
            opacity: 0.7;
        }
        .total-box, .pending-box {
            background: var(--dark-blue);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
        }
        .pending-box {
            background: #EF4444;
            color: white;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <h4>RehabCare+</h4>
        <a href="/dashboard">üè† Dashboard</a>
        <a href="/add_patient">‚ûï Add Patient</a>
        <a href="/patients">üßç Patients List</a>
        <a href="/rooms">üõè Rooms</a>
        <a href="/billing" class="active">üí≥ Billing</a>
        <a href="/medicine_history">üíä Medicine History</a>
        <a href="/logout">üö™ Logout</a>
    </div>

    <div class="content">
        <div class="navbar-custom">
            <span class="nav-title">Viewing Invoice #{{ bill.INVOICE_NUMBER }}</span>
            <button class="btn-outline btn-custom" onclick="toggleSidebar()">‚ò∞</button>
        </div>

        <div class="card-custom" style="padding: 30px; margin-top: 20px;">
            
            <div class="invoice-header">
                <div><span class="invoice-id">INVOICE: #{{ bill.INVOICE_NUMBER }}</span></div>
                <div>
                    {% if bill.PENDING_AMOUNT > 0 %}
                    <a href="/record_payment/{{ bill.BILL_ID }}" class="action-btn view-btn" style="background: #FBBF24; color: var(--darker-blue); text-decoration: none;">üíµ Record Payment</a>
                    {% else %}
                    <span class="status-paid">Paid in Full</span>
                    {% endif %}
                    <a href="/billing" class="action-btn edit-btn" style="text-decoration: none;">‚¨ÖÔ∏è Back to Billing</a>
                </div>
            </div>

            <div style="display: flex; gap: 30px; margin-bottom: 30px;">
                <div style="flex: 2;">
                    <div style="display: flex; gap: 20px;">
                        <div class="invoice-summary-box" style="flex: 1;">
                            <h5>Billed To</h5>
                            <p>Patient: {{ bill.FULL_NAME }}</p>
                            <p style="opacity: 0.8; font-size: 0.9em;">Branch: {{ bill.BRANCH_NAME }}</p>
                        </div>
                        <div class="invoice-summary-box" style="flex: 1;">
                            <h5>Invoice Dates</h5>
                            <p>Issue Date: {{ bill.ISSUE_DATE }}</p>
                            <p style="opacity: 0.8; font-size: 0.9em;">Due Date: {{ bill.DUE_DATE }}</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h4 style="margin-bottom: 15px; color: #10B981;">Payment History</h4>
                        
                        {% if payments and payments|length > 0 %}
                        <div class="table-scroll">
                            <table class="table-custom">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Recorded By</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for payment in payments %}
                                    <tr>
                                        <td>{{ payment.PAYMENT_DATE }}</td>
                                        <td>PKR {{ payment.AMOUNT_PAID | int }}</td>
                                        <td>{{ payment.PAYMENT_METHOD }}</td>
                                        <td>{{ payment.RECORDED_BY }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p style="text-align: center; color: var(--text-muted); padding: 20px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            No payments recorded yet. Click "Record Payment" above to add a payment.
                        </p>
                        {% endif %}
                    </div>
                </div>

                <div style="flex: 1; padding-left: 20px;">
                    <div class="invoice-summary-box">
                        <h5>Total Bill Amount</h5>
                        <p style="font-size: 1.5em; color: var(--text-light);">PKR {{ bill.BILL_AMOUNT | int }}</p>
                    </div>

                    <div class="total-box" style="background: #10B981;">
                        Total Paid: PKR {{ (bill.BILL_AMOUNT - bill.PENDING_AMOUNT) | int }}
                    </div>

                    <div class="pending-box">
                        <h3 style="margin: 0;">Balance Due</h3>
                        <h1 style="margin: 5px 0 0 0; color: white;">PKR {{ bill.PENDING_AMOUNT | int }}</h1>
                    </div>
                </div>
            </div>
            
            <p style="margin-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 15px; font-style: italic; opacity: 0.8;">
                **Description:** {{ bill.DESCRIPTION }}
            </p>

        </div>
    </div>

    <script>
        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("active");
        }
    </script>
</body>
</html>