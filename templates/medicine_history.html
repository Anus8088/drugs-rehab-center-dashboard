<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medicine History | RehabCare+</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* Specific CSS for low stock card */
        .low-stock-card {
            border-left: 5px solid #EF4444; /* Red border for urgency */
            background: rgba(239, 68, 68, 0.1);
        }
        .low-stock-card h1 {
            color: #EF4444 !important;
        }
        .btn-record {
            background: #10B981; /* Green for consistency (Primary Action) */
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .inventory-card h4 {
            margin-bottom: 8px;
            color: var(--primary-blue);
        }
    </style>
</head>

<body>

    <div class="sidebar" id="sidebar">
        <h4>RehabCare+</h4>
        <a href="/dashboard">üè† Dashboard</a>
        <a href="/add_patient">‚ûï Add Patient</a>
        <a href="/patients">üßç Patients List</a>
        <a href="/rooms">üõè Rooms</a>
        <a href="/billing">üí≥ Billing</a>
        <a href="/medicine_history" class="active">üíä Medicine History</a>
        <a href="/logout">üö™ Logout</a>
    </div>

    <div class="content">

        <div class="navbar-custom">
            <span class="nav-title">Medicine Inventory & Administration</span>
            <button class="btn-outline btn-custom" onclick="toggleSidebar()">‚ò∞</button>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="flash-message flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <h3 style="margin-top: 20px; margin-bottom: 15px; color: #10B981;">Current Medicine Inventory</h3>
        
        <div style="display: flex; justify-content: flex-end; margin-bottom: 20px;">
            <a href="/add_medicine" class="btn-record" style="background: #FBBF24; color: var(--darker-blue); text-decoration: none;">‚ûï Add New / Restock</a>
        </div>

        <div class="inventory-grid">
            {% for med in inventory %}
                {% set low_stock = med.CURRENT_STOCK < 30 %}
                <div class="card-custom inventory-card {% if low_stock %}low-stock-card{% endif %}" style="padding: 20px;">
                    <h4>{{ med.MEDICINE_NAME }}</h4>
                    <p style="opacity: 0.8; font-size: 0.9em;">Unit: {{ med.UNIT }}</p>
                    <h1 style="margin: 10px 0;">
                        {{ med.CURRENT_STOCK }} 
                        <span style="font-size: 0.5em; opacity: 0.7;">{{ med.UNIT }}</span>
                    </h1>
                    
                    {% if low_stock %}
                        <p style="color: #EF4444; font-weight: 600;">‚ö†Ô∏è Low Stock! Needs reordering.</p>
                    {% endif %}

                    <a href="/add_medicine?med_id={{ med.MEDICINE_ID }}" class="action-btn edit-btn" style="text-decoration: none; margin-top: 10px; display: inline-block;">Restock</a>
                </div>
            {% endfor %}
        </div>

        <div class="card-custom" style="margin-top: 20px; padding: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #FBBF24;">Recent Administration Records</h3>
                <a href="/record_dose" class="btn-record" style="text-decoration: none;">üìù Record New Dose</a>
            </div>
            
            <div class="table-scroll">
                <table class="table-custom">
                    <thead>
                        <tr>
                            <th>Record ID</th>
                            <th>Patient Name</th>
                            <th>Medicine</th>
                            <th>Dosage</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Administered By</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for rec in records %}
                        <tr>
                            <td>{{ rec.RECORD_ID }}</td>
                            <td><a href="/view_patient/{{ rec.PATIENT_ID }}" style="color: var(--primary-blue); text-decoration: none;">{{ rec.FULL_NAME }}</a></td>
                            <td>{{ rec.MEDICINE_NAME }}</td>
                            <td>{{ rec.DOSAGE }}</td>
                            <td>{{ rec.ADMIN_DATE }}</td>
                            <td>{{ rec.ADMIN_TIME }}</td>
                            <td>{{ rec.ADMINISTERED_BY }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>